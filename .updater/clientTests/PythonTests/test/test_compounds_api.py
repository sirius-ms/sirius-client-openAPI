# coding: utf-8

"""
    SIRIUS Nightsky API

    REST API that provides the full functionality of SIRIUS and its web services as background service. It is intended as entry-point for scripting languages and software integration SDKs.This API is exposed by SIRIUS 6.0.0-SNAPSHOT

    The version of the OpenAPI document: 2.1
    Generated by OpenAPI Generator (https://openapi-generator.tech)

    Do not edit the class manually.
"""  # noqa: E501


import os
import json
import shutil
import unittest

import PySirius
from PySirius import PySiriusAPI
from PySirius.models.compound import Compound
from PySirius.models.trace_set import TraceSet
from PySirius.models.page_compound import PageCompound
from PySirius.models.compound_import import CompoundImport



class TestCompoundsApi(unittest.TestCase):
    """CompoundsApi unit test stubs"""

    def setUp(self) -> None:
        self.api = PySiriusAPI(PySirius.ApiClient())
        self.project_id = "test_compounds_api"
        self.path_to_project = f"{os.environ.get('HOME')}/test_compounds_api_dir"
        self.api.get_ProjectsApi().create_project_space(self.project_id, self.path_to_project)

        # equals test_add_compounds
        simple_peak_json = {
            "mz": 1.23,
            "intensity": 1.23
        }

        basic_spectrum_json = {
            "precursorMz": 1.23,
            "peaks": [
                simple_peak_json
            ]
        }

        feature_import_json = {
            "ionMass": 1.23,
            "charge": 1,
            "ms1Spectra": [
                basic_spectrum_json
            ],
            "ms2Spectra": [
                basic_spectrum_json
            ]
        }

        compound_import_json = {
            "features": [
                feature_import_json
            ]
        }

        compound_import_instance = CompoundImport.from_json(json.dumps(compound_import_json))
        compound_import = [compound_import_instance]
        self.api.get_CompoundsApi().add_compounds(self.project_id, compound_import)

    def tearDown(self) -> None:
        self.api.get_ProjectsApi().close_project_space(self.project_id)
        os.remove(self.path_to_project)

    def test_add_compounds(self) -> None:
        """Test case for add_compounds

        Import Compounds and its contained features.
        """
        pass

    def test_delete_compound(self) -> None:
        """Test case for delete_compound

        Delete compound (group of ion identities) with the given identifier (and the included features) from the  specified project-space.
        """
        compound_id = self.api.get_CompoundsApi().get_compounds(self.project_id)[0].compound_id
        response_before = self.api.get_CompoundsApi().get_compounds(self.project_id)
        self.api.get_CompoundsApi().delete_compound(self.project_id, compound_id)
        response_after = self.api.get_CompoundsApi().get_compounds(self.project_id)

        self.assertIsInstance(response_before, list)
        self.assertEqual(len(response_before), 1)
        self.assertIsInstance(response_before[0], Compound)

        self.assertIsInstance(response_after, list)
        self.assertEqual(len(response_after), 0)

    def test_get_compound(self) -> None:
        """Test case for get_compound

        Get compound (group of ion identities) with the given identifier from the specified project-space.
        """
        compound_id = self.api.get_CompoundsApi().get_compounds(self.project_id)[0].compound_id
        response = self.api.get_CompoundsApi().get_compound(self.project_id, compound_id)
        self.assertIsInstance(response, Compound)

    def test_get_compounds(self) -> None:
        """Test case for get_compounds

        List of all available compounds (group of ion identities) in the given project-space.
        """
        response = self.api.get_CompoundsApi().get_compounds(self.project_id)
        self.assertIsInstance(response, list)
        self.assertEqual(len(response), 1)
        self.assertIsInstance(response[0], Compound)

    def test_get_compounds_paged(self) -> None:
        """Test case for get_compounds_paged

        Page of available compounds (group of ion identities) in the given project-space.
        """
        response = self.api.get_CompoundsApi().get_compounds_paged(self.project_id)
        self.assertIsInstance(response, PageCompound)

    def test_get_traces(self) -> None:
        """Test case for get_traces

        """
        # TODO "No trace information available for project id = test_compounds_api and compound id = 599595888450877371"
        # compound_id = self.api.get_CompoundsApi().get_compounds(self.project_id)[0].compound_id
        # response = self.api.get_CompoundsApi().get_traces(self.project_id, compound_id)
        # self.assertIsInstance(response, TraceSet)

if __name__ == '__main__':
    unittest.main()
