#' SIRIUS Nightsky API
#'
#' REST API that provides the full functionality of SIRIUS and its web services as background service. It is intended as entry-point for scripting languages and software integration SDKs.This API is exposed by SIRIUS 6
#'
#' The version of the OpenAPI document: 3.1
#' Generated by: https://openapi-generator.tech
#'
#' @docType class
#' @title Actuator operations
#' @description ActuatorApi
#' @format An \code{R6Class} generator object
#' @field api_client Handles the client-server communication.
#'
#' @examples
#' \dontrun{
#' ####################  Health  ####################
#'
#' library(RSirius)
#'
#' #Actuator web endpoint 'health'
#' api_instance <- rsirius_api$new()
#'
#' # to save the result into a file, simply add the optional `data_file` parameter, e.g.
#' # result <- api_instance$Health(data_file = "result.txt")
#' result <- api_instance$actuator_api$Health()
#' dput(result)
#'
#'
#' ####################  Shutdown  ####################
#'
#' library(RSirius)
#'
#' #Actuator web endpoint 'shutdown'
#' api_instance <- rsirius_api$new()
#'
#' api_instance$actuator_api$Shutdown()
#'
#'
#' }
#' @importFrom R6 R6Class
#' @importFrom base64enc base64encode
#' @export
ActuatorApi <- R6::R6Class(
  "ActuatorApi",
  public = list(
    api_client = NULL,

    #' @description
    #' Initialize a new ActuatorApi.
    #'
    #' @param api_client An instance of API client.
    initialize = function(api_client) {
      if (!missing(api_client)) {
        self$api_client <- api_client
      } else {
        self$api_client <- ApiClient$new()
      }
    },

    #' @description
    #' Actuator web endpoint 'health'
    #'
    #' @param data_file (optional) name of the data file to save the result
    #' @param ... Other optional arguments
    #'
    #' @return object
    Health = function(data_file = NULL, ...) {
      local_var_response <- self$HealthWithHttpInfo(data_file = data_file, ...)
      if (local_var_response$status_code >= 200 && local_var_response$status_code <= 299) {
        local_var_response$content
      } else if (local_var_response$status_code >= 300 && local_var_response$status_code <= 399) {
        local_var_response
      } else if (local_var_response$status_code >= 400 && local_var_response$status_code <= 499) {
        local_var_response
      } else if (local_var_response$status_code >= 500 && local_var_response$status_code <= 599) {
        local_var_response
      }
    },

    #' @description
    #' Actuator web endpoint 'health'
    #'
    #' @param data_file (optional) name of the data file to save the result
    #' @param ... Other optional arguments
    #'
    #' @return API response (object) with additional information such as HTTP status code, headers
    HealthWithHttpInfo = function(data_file = NULL, ...) {
      args <- list(...)
      query_params <- list()
      header_params <- c()
      form_params <- list()
      file_params <- list()
      local_var_body <- NULL
      oauth_scopes <- NULL
      is_oauth <- FALSE

      local_var_url_path <- "/actuator/health"

      # The Accept request HTTP header
      local_var_accepts <- list("application/vnd.spring-boot.actuator.v3+json", "application/vnd.spring-boot.actuator.v2+json", "application/json")

      # The Content-Type representation header
      local_var_content_types <- list()

      local_var_resp <- self$api_client$CallApi(url = paste0(self$api_client$base_path, local_var_url_path),
                                 method = "GET",
                                 query_params = query_params,
                                 header_params = header_params,
                                 form_params = form_params,
                                 file_params = file_params,
                                 accepts = local_var_accepts,
                                 content_types = local_var_content_types,
                                 body = local_var_body,
                                 is_oauth = is_oauth,
                                 oauth_scopes = oauth_scopes,
                                 ...)

      if (local_var_resp$status_code >= 200 && local_var_resp$status_code <= 299) {
        # save response in a file
        if (!is.null(data_file)) {
          write(local_var_resp$response, data_file)
        }

        # Check if we are expecting a CSV response
        is_csv_response <- any(grepl("csv", local_var_accepts, ignore.case = TRUE))

        if (is_csv_response) {
          # For CSV responses, parse into data.frame
          csv_resp_obj <- tryCatch(
            {
              csv_text <- rawToChar(local_var_resp$response)

              # Detect separator by examining first line
              first_line <- strsplit(csv_text, "\n")[[1]][1]
              if (grepl("\t", first_line)) {
                # Tab-separated (TSV)
                read.csv(text = csv_text, stringsAsFactors = FALSE, sep = "\t")
              } else {
                # Comma-separated (CSV)
                read.csv(text = csv_text, stringsAsFactors = FALSE, sep = ",")
              }
            },
            error = function(e) {
              stop("Failed to parse CSV response")
            }
          )
          local_var_resp$content <- csv_resp_obj
        } else {
          # For JSON responses, deserialize normally
          deserialized_resp_obj <- tryCatch(
            self$api_client$deserialize(local_var_resp$response_as_text(), "object", loadNamespace("RSirius")),
            error = function(e) {
              stop("Failed to deserialize response")
            }
          )
          local_var_resp$content <- deserialized_resp_obj
        }
        local_var_resp
      } else if (local_var_resp$status_code >= 300 && local_var_resp$status_code <= 399) {
        ApiResponse$new(paste("Server returned ", local_var_resp$status_code, " response status code."), local_var_resp)
      } else if (local_var_resp$status_code >= 400 && local_var_resp$status_code <= 499) {
        ApiResponse$new("API client error", local_var_resp)
      } else if (local_var_resp$status_code >= 500 && local_var_resp$status_code <= 599) {
        if (is.null(local_var_resp$response) || local_var_resp$response == "") {
          local_var_resp$response <- "API server error"
        }
        local_var_resp
      }
    },

    #' @description
    #' Actuator web endpoint 'shutdown'
    #'
    #' @param ... Other optional arguments
    #'
    #' @return void
    Shutdown = function(...) {
      local_var_response <- self$ShutdownWithHttpInfo(...)
      if (local_var_response$status_code >= 200 && local_var_response$status_code <= 299) {
        local_var_response$content
      } else if (local_var_response$status_code >= 300 && local_var_response$status_code <= 399) {
        local_var_response
      } else if (local_var_response$status_code >= 400 && local_var_response$status_code <= 499) {
        local_var_response
      } else if (local_var_response$status_code >= 500 && local_var_response$status_code <= 599) {
        local_var_response
      }
    },

    #' @description
    #' Actuator web endpoint 'shutdown'
    #'
    #' @param ... Other optional arguments
    #'
    #' @return API response (void) with additional information such as HTTP status code, headers
    ShutdownWithHttpInfo = function(...) {
      args <- list(...)
      query_params <- list()
      header_params <- c()
      form_params <- list()
      file_params <- list()
      local_var_body <- NULL
      oauth_scopes <- NULL
      is_oauth <- FALSE

      local_var_url_path <- "/actuator/shutdown"

      # The Accept request HTTP header
      local_var_accepts <- list()

      # The Content-Type representation header
      local_var_content_types <- list()

      local_var_resp <- self$api_client$CallApi(url = paste0(self$api_client$base_path, local_var_url_path),
                                 method = "POST",
                                 query_params = query_params,
                                 header_params = header_params,
                                 form_params = form_params,
                                 file_params = file_params,
                                 accepts = local_var_accepts,
                                 content_types = local_var_content_types,
                                 body = local_var_body,
                                 is_oauth = is_oauth,
                                 oauth_scopes = oauth_scopes,
                                 ...)

      if (local_var_resp$status_code >= 200 && local_var_resp$status_code <= 299) {
        local_var_resp$content <- NULL
        local_var_resp
      } else if (local_var_resp$status_code >= 300 && local_var_resp$status_code <= 399) {
        ApiResponse$new(paste("Server returned ", local_var_resp$status_code, " response status code."), local_var_resp)
      } else if (local_var_resp$status_code >= 400 && local_var_resp$status_code <= 499) {
        ApiResponse$new("API client error", local_var_resp)
      } else if (local_var_resp$status_code >= 500 && local_var_resp$status_code <= 599) {
        if (is.null(local_var_resp$response) || local_var_resp$response == "") {
          local_var_resp$response <- "API server error"
        }
        local_var_resp
      }
    }
  )
)
