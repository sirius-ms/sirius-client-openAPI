# Automatically generated by openapi-generator (https://openapi-generator.tech)
# Please update as you see appropriate

context("Test CompoundsApi")

sdk <- SiriusSDK$new()
api <- sdk$attach_to_sirius(sirius_port=8080)
api_instance <- api$compounds_api
projects_api <- api$projects_api

basic_spectrum <- c(BasicSpectrum$new(peaks = c(SimplePeak$new(1.23, 4.56)), precursorMz = 1.23))
feature_import <- c(FeatureImport$new(ionMass = 1.23, charge = 1, ms1Spectra = basic_spectrum, ms2Spectra = basic_spectrum))
compound_import <- c(CompoundImport$new(features = feature_import))

test_that("AddCompounds", {
  # tests for AddCompounds
  # base path: http://localhost:8080
  # Import Compounds and its contained features.
  # Import Compounds and its contained features. Compounds and Features must not exist in the project.  Otherwise, they will exist twice.
  # @param project_id character project-space to import into.
  # @param compound_import array[CompoundImport] the compound data to be imported
  # @param opt_fields array[CompoundOptField] set of optional fields to be included. Use 'none' to override defaults. (optional)
  # @param opt_fields_features array[AlignedFeatureOptField] set of optional fields of the nested features to be included. Use 'none' to override defaults. (optional)
  # @return [array[Compound]]

  tryCatch({

    project_id <- "AddCompounds"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    projects_api$CreateProject(project_id, project_dir)

    response <- api_instance$AddCompounds(project_id, compound_import)
    expect_true(inherits(response, "list"))
    expect_true(inherits(response[[1]], "Compound"))

  }, finally = {

    projects_api$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("DeleteCompound", {
  # tests for DeleteCompound
  # base path: http://localhost:8080
  # Delete compound (group of ion identities) with the given identifier (and the included features) from the  specified project-space.
  # Delete compound (group of ion identities) with the given identifier (and the included features) from the  specified project-space.
  # @param project_id character project-space to delete from.
  # @param compound_id character identifier of the compound to delete.
  # @return [Void]

  tryCatch({

    project_id <- "DeleteCompound"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    projects_api$CreateProject(project_id, project_dir)
    api_instance$AddCompounds(project_id, compound_import)
    compound_id <- api_instance$GetCompounds(project_id)[[1]]$compoundId

    response_before <- api_instance$GetCompounds(project_id)
    api_instance$DeleteCompound(project_id, compound_id)
    response_after <- api_instance$GetCompounds(project_id)

    expect_equal(length(response_before) - length(response_after), 2)

  }, finally = {

    projects_api$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("GetCompound", {
  # tests for GetCompound
  # base path: http://localhost:8080
  # Get compound (group of ion identities) with the given identifier from the specified project-space.
  # Get compound (group of ion identities) with the given identifier from the specified project-space.
  # @param project_id character project-space to read from.
  # @param compound_id character identifier of the compound (group of ion identities) to access.
  # @param opt_fields array[CompoundOptField] set of optional fields to be included. Use 'none' only to override defaults. (optional)
  # @param opt_fields_features array[AlignedFeatureOptField]  (optional)
  # @return [Compound]

  tryCatch({

    project_id <- "GetCompound"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    projects_api$CreateProject(project_id, project_dir)
    api_instance$AddCompounds(project_id, compound_import)
    compound_id <- api_instance$GetCompounds(project_id)[[1]]$compoundId

    response <- api_instance$GetCompound(project_id, compound_id)
    expect_true(inherits(response, "Compound"))

  }, finally = {

    projects_api$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("GetCompounds", {
  # tests for GetCompounds
  # base path: http://localhost:8080
  # List of all available compounds (group of ion identities) in the given project-space.
  # List of all available compounds (group of ion identities) in the given project-space.
  # @param project_id character project-space to read from.
  # @param opt_fields array[CompoundOptField] set of optional fields to be included. Use 'none' only to override defaults. (optional)
  # @param opt_fields_features array[AlignedFeatureOptField]  (optional)
  # @return [array[Compound]]

  tryCatch({

    project_id <- "GetCompounds"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    projects_api$CreateProject(project_id, project_dir)
    api_instance$AddCompounds(project_id, compound_import)

    response <- api_instance$GetCompounds(project_id)
    expect_true(inherits(response, "list"))
    expect_true(inherits(response[[1]], "Compound"))

  }, finally = {

    projects_api$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("GetCompoundsPaged", {
  # tests for GetCompoundsPaged
  # base path: http://localhost:8080
  # Page of available compounds (group of ion identities) in the given project-space.
  # Page of available compounds (group of ion identities) in the given project-space.
  # @param project_id character project-space to read from.
  # @param page integer Zero-based page index (0..N) (optional)
  # @param size integer The size of the page to be returned (optional)
  # @param sort array[character] Sorting criteria in the format: property,(asc|desc). Default sort order is ascending. Multiple sort criteria are supported. (optional)
  # @param opt_fields array[CompoundOptField] set of optional fields to be included. Use 'none' only to override defaults. (optional)
  # @param opt_fields_features array[AlignedFeatureOptField]  (optional)
  # @return [PageCompound]

  tryCatch({

    project_id <- "GetCompoundsPaged"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    projects_api$CreateProject(project_id, project_dir)

    response <- api_instance$GetCompoundsPaged(project_id)
    expect_true(inherits(response, "PagedModelCompound"))

  }, finally = {

    projects_api$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})