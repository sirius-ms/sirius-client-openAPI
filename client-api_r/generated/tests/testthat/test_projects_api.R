# Automatically generated by openapi-generator (https://openapi-generator.tech)
# Please update as you see appropriate

context("Test ProjectsApi")

sdk <- SiriusSDK$new()
api <- sdk$attach_to_sirius()
api_instance <- api$projects_api
path_to_demo_data <- paste(Sys.getenv("HOME"), "sirius-client-openAPI/.updater/clientTests/Data", sep = "/")
preproc_ms2_file_1 <- paste(path_to_demo_data, "Kaempferol.ms", sep = "/")
preproc_ms2_file_2 <- paste(path_to_demo_data, "laudanosine.mgf", sep = "/")
full_ms_file <- paste(path_to_demo_data, "SPF4_Eso3_GH6_01_22643.mzXML", sep = "/")


test_that("CloseProject", {
  # tests for CloseProject
  # base path: http://localhost:8080
  # Close project-space and remove it from application
  # Close project-space and remove it from application. Project will NOT be deleted from disk.  &lt;p&gt;  ATTENTION: This will cancel and remove all jobs running on this Project before closing it.  If there are many jobs, this might take some time.
  # @param project_id character unique name/identifier of the  project-space to be closed.
  # @return [Void]

  tryCatch({

    project_id <- "CloseProject"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")

    api_instance$CreateProject(project_id, project_dir)
    response_before <- api_instance$GetProjects()
    api_instance$CloseProject(project_id)
    response_after <- api_instance$GetProjects()

    expect_equal(length(response_before), length(response_after) + 1)

  }, finally = {

    unlink(project_dir, recursive = TRUE)

  })
})

test_that("CreateProject", {
  # tests for CreateProject
  # base path: http://localhost:8080
  # Create and open a new project-space at given location and make it accessible via the given projectId.
  # Create and open a new project-space at given location and make it accessible via the given projectId.
  # @param project_id character unique name/identifier that shall be used to access the newly created project-space. Must consist only of [a-zA-Z0-9_-].
  # @param path_to_project character local file path where the project will be created. If NULL, project will be stored by its projectId in default project location. DEPRECATED: This parameter relies on the local filesystem and will likely be removed in later versions of this API to allow for more flexible use cases. (optional)
  # @return [ProjectInfo]

  tryCatch({

    project_id <- "CreateProject"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")

    response <- api_instance$CreateProject(project_id, project_dir)
    expect_true(inherits(response, "ProjectInfo"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("GetCanopusClassyFireData", {
  # tests for GetCanopusClassyFireData
  # base path: http://localhost:8080
  # Get CANOPUS prediction vector definition for ClassyFire classes
  # @param project_id character
  # @param charge integer
  # @return [character]

  tryCatch({

    project_id <- "GetCanopusClassyFireData"
    project_dir <- paste(Sys.getenv("HOME"), "tomato_small.sirius", sep = "/")
    api_instance$OpenProject(project_id, project_dir)

    response <- api_instance$GetCanopusClassyFireData(project_id, 1)
    expect_true(inherits(response, "data.frame"))

  }, finally = {

    api_instance$CloseProject(project_id)

  })
})

test_that("GetCanopusNpcData", {
  # tests for GetCanopusNpcData
  # base path: http://localhost:8080
  # Get CANOPUS prediction vector definition for NPC classes
  # @param project_id character
  # @param charge integer
  # @return [character]

  tryCatch({

    project_id <- "GetCanopusNpcData"
    project_dir <- paste(Sys.getenv("HOME"), "tomato_small.sirius", sep = "/")
    api_instance$OpenProject(project_id, project_dir)

    response <- api_instance$GetCanopusNpcData(project_id, 1)
    expect_true(inherits(response, "data.frame"))

  }, finally = {

    api_instance$CloseProject(project_id)

  })
})

test_that("GetFingerIdData", {
  # tests for GetFingerIdData
  # base path: http://localhost:8080
  # Get CSI:FingerID fingerprint (prediction vector) definition
  # @param project_id character
  # @param charge integer
  # @return [character]

  tryCatch({

    project_id <- "GetFingerIdData"
    project_dir <- paste(Sys.getenv("HOME"), "tomato_small.sirius", sep = "/")
    api_instance$OpenProject(project_id, project_dir)

    response <- api_instance$GetFingerIdData(project_id, 1)
    expect_true(inherits(response, "data.frame"))
    expect_true(inherits(response$relativeIndex, "integer"))
    expect_true(inherits(response$description, "character"))

  }, finally = {

    api_instance$CloseProject(project_id)

  })
})

test_that("GetProject", {
  # tests for GetProject
  # base path: http://localhost:8080
  # Get project space info by its projectId.
  # Get project space info by its projectId.
  # @param project_id character unique name/identifier tof the project-space to be accessed.
  # @param opt_fields array[ProjectInfoOptField]  (optional)
  # @return [ProjectInfo]

  tryCatch({

    project_id <- "GetProject"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    response <- api_instance$GetProject(project_id)
    expect_true(inherits(response, "ProjectInfo"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("GetProjects", {
  # tests for GetProjects
  # base path: http://localhost:8080
  # List opened project spaces.
  # List opened project spaces.
  # @return [array[ProjectInfo]]

  tryCatch({

    project_id <- "GetProjects"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    response <- api_instance$GetProjects()
    expect_true(inherits(response, "list"))
    expect_true(inherits(response[[1]], "ProjectInfo"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("ImportMsRunData", {
  # tests for ImportMsRunData
  # base path: http://localhost:8080
  # Import and Align full MS-Runs from various formats into the specified project  Possible formats (mzML, mzXML)
  # Import and Align full MS-Runs from various formats into the specified project  Possible formats (mzML, mzXML)
  # @param project_id character Project-space to import into.
  # @param parameters LcmsSubmissionParameters Parameters for feature alignment and feature finding.
  # @param allow_ms1_only character Import data without MS/MS. (optional)
  # @param input_files array[data.frame]  (optional)
  # @return [ImportResult]

  #   Request processing failed: java.lang.RuntimeException: java.lang.NullPointerException: Cannot invoke "de.unijena.bioinf.ms.frontend.subtools.lcms_align.DataSmoothing.ordinal()" because "filter" is null
  #   project_id <- "ImportMsRunData"
  #   project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep="/")
  #   api_instance$CreateProject(project_id, project_dir)
  #
  #   var_input_files <- full_ms_file
  #   var_parameters <- LcmsSubmissionParameters$new()$toJSON()
  #   response <- api_instance$ImportMsRunData(project_id, var_parameters, input_files=var_input_files)
  #   expect_true(inherits(response, "ImportResult"))
  #
  #   withr::defer(api_instance$CloseProject(project_id))
  #   withr::defer(unlink(project_dir, recursive=TRUE))
})

test_that("ImportMsRunDataAsJob", {
  # tests for ImportMsRunDataAsJob
  # base path: http://localhost:8080
  # Import and Align full MS-Runs from various formats into the specified project as background job.
  # Import and Align full MS-Runs from various formats into the specified project as background job.  Possible formats (mzML, mzXML)
  # @param project_id character Project-space to import into.
  # @param parameters LcmsSubmissionParameters Parameters for feature alignment and feature finding.
  # @param allow_ms1_only character Import data without MS/MS. (optional)
  # @param opt_fields array[JobOptField] Set of optional fields to be included. Use 'none' only to override defaults. (optional)
  # @param input_files array[data.frame]  (optional)
  # @return [Job]

  #   project_id <- "ImportMsRunDataAsJob"
  #   project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep="/")
  #   api_instance$CreateProject(project_id, project_dir)
  #
  #   var_input_files <- full_ms_file
  #   var_parameters <- LcmsSubmissionParameters$new(TRUE)$toJSONString()
  #   response <- api_instance$ImportMsRunDataAsJob(project_id, parameters=var_parameters, input_files=var_input_files)
  #   expect_true(inherits(response, "Job"))
  #
  #   withr::defer(api_instance$CloseProject(project_id))
  #   withr::defer(unlink(project_dir, recursive=TRUE))
})

test_that("ImportPreprocessedData", {
  # tests for ImportPreprocessedData
  # base path: http://localhost:8080
  # Import already preprocessed ms/ms data from various formats into the specified project  Possible formats (ms, mgf, cef, msp)
  # Import already preprocessed ms/ms data from various formats into the specified project  Possible formats (ms, mgf, cef, msp)
  # @param project_id character project-space to import into.
  # @param ignore_formulas character  (optional)
  # @param allow_ms1_only character  (optional)
  # @param input_files array[data.frame]  (optional)
  # @return [ImportResult]

  # TEST 1: single file as characters
  tryCatch({

    project_id <- "ImportPreprocessedData1"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- preproc_ms2_file_1
    response <- api_instance$ImportPreprocessedData(project_id, input_files = var_input_files)
    expect_true(inherits(response, "ImportResult"))
    expect_equal(length(response$affectedCompoundIds), 1)
    expect_equal(length(response$affectedAlignedFeatureIds), 1)

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 2: single file in vector
  tryCatch({

    project_id <- "ImportPreprocessedData2"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- c(preproc_ms2_file_1)
    response <- api_instance$ImportPreprocessedData(project_id, input_files = var_input_files)
    expect_true(inherits(response, "ImportResult"))
    expect_equal(length(response$affectedCompoundIds), 1)
    expect_equal(length(response$affectedAlignedFeatureIds), 1)

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 3: multiple files in vector
  tryCatch({

    project_id <- "ImportPreprocessedData3"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- c(preproc_ms2_file_1, preproc_ms2_file_2)
    response <- api_instance$ImportPreprocessedData(project_id, input_files = var_input_files)
    expect_true(inherits(response, "ImportResult"))
    expect_equal(length(response$affectedCompoundIds), 2)
    expect_equal(length(response$affectedAlignedFeatureIds), 2)

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 4: single file in list
  tryCatch({

    project_id <- "ImportPreprocessedData4"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- list(preproc_ms2_file_1)
    response <- api_instance$ImportPreprocessedData(project_id, input_files = var_input_files)
    expect_true(inherits(response, "ImportResult"))
    expect_equal(length(response$affectedCompoundIds), 1)
    expect_equal(length(response$affectedAlignedFeatureIds), 1)

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 5: multiple files in list
  tryCatch({

    project_id <- "ImportPreprocessedData5"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- list(preproc_ms2_file_1, preproc_ms2_file_2)
    response <- api_instance$ImportPreprocessedData(project_id, input_files = var_input_files)
    expect_true(inherits(response, "ImportResult"))
    expect_equal(length(response$affectedCompoundIds), 2)
    expect_equal(length(response$affectedAlignedFeatureIds), 2)

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("ImportPreprocessedDataAsJob", {
  # tests for ImportPreprocessedDataAsJob
  # base path: http://localhost:8080
  # Import ms/ms data from the given format into the specified project-space as background job.
  # Import ms/ms data from the given format into the specified project-space as background job.  Possible formats (ms, mgf, cef, msp)
  # @param project_id character project-space to import into.
  # @param ignore_formulas character  (optional)
  # @param allow_ms1_only character  (optional)
  # @param opt_fields array[JobOptField] set of optional fields to be included. Use 'none' only to override defaults. (optional)
  # @param input_files array[data.frame]  (optional)
  # @return [Job]

  # TEST 1: single file as characters
  tryCatch({

    project_id <- "ImportPreprocessedDataAsJob1"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- preproc_ms2_file_1
    response <- api_instance$ImportPreprocessedDataAsJob(project_id, input_files = var_input_files)
    expect_true(inherits(response, "Job"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 2: single file in vector
  tryCatch({

    project_id <- "ImportPreprocessedDataAsJob2"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- c(preproc_ms2_file_1)
    response <- api_instance$ImportPreprocessedDataAsJob(project_id, input_files = var_input_files)
    expect_true(inherits(response, "Job"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 3: multiple files in vector
  tryCatch({

    project_id <- "ImportPreprocessedDataAsJob3"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- c(preproc_ms2_file_1, preproc_ms2_file_2)
    response <- api_instance$ImportPreprocessedDataAsJob(project_id, input_files = var_input_files)
    expect_true(inherits(response, "Job"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 4: single file in list
  tryCatch({

    project_id <- "ImportPreprocessedDataAsJob4"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- list(preproc_ms2_file_1)
    response <- api_instance$ImportPreprocessedDataAsJob(project_id, input_files = var_input_files)
    expect_true(inherits(response, "Job"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })

  # TEST 5: multiple files in list
  tryCatch({

    project_id <- "ImportPreprocessedDataAsJob5"
    project_dir <- paste(Sys.getenv("HOME"), paste0(project_id, ".sirius"), sep = "/")
    api_instance$CreateProject(project_id, project_dir)

    var_input_files <- list(preproc_ms2_file_1, preproc_ms2_file_2)
    response <- api_instance$ImportPreprocessedDataAsJob(project_id, input_files = var_input_files)
    expect_true(inherits(response, "Job"))

  }, finally = {

    api_instance$CloseProject(project_id)
    unlink(project_dir, recursive = TRUE)

  })
})

test_that("OpenProject", {
  # tests for OpenProject
  # base path: http://localhost:8080
  # Open an existing project-space and make it accessible via the given projectId.
  # Open an existing project-space and make it accessible via the given projectId.
  # @param project_id character unique name/identifier that shall be used to access the opened project-space. Must consist only of [a-zA-Z0-9_-].
  # @param path_to_project character local file path to open the project from. If NULL, project will be loaded by it projectId from default project location.  DEPRECATED: This parameter relies on the local filesystem and will likely be removed in later versions of this API to allow for more flexible use cases. (optional)
  # @param opt_fields array[ProjectInfoOptField]  (optional)
  # @return [ProjectInfo]

  tryCatch({

    project_id <- "OpenProject"
    project_dir <- paste(Sys.getenv("HOME"), "tomato_small.sirius", sep = "/")

    response <- api_instance$OpenProject(project_id, project_dir)
    expect_true(inherits(response, "ProjectInfo"))

  }, finally = {

    api_instance$CloseProject(project_id)

  })
})
